import { Injectable } from '@nestjs/common';

import {
  CreateMarkdownDto,
  TeamStyle,
  TechStack,
  GroundRules,
} from './dto/create-markdown.dto';

@Injectable()
export class MarkdownService {
  createMarkdown(createMarkdownDto: CreateMarkdownDto) {
    const teamStyleString = this.createTeamStyleString(
      createMarkdownDto.teamStyles,
    );
    const techStackString = this.createTechStackString(
      createMarkdownDto.techStacks,
    );
    const groundRulesString = this.createGroundRulesString(
      createMarkdownDto.groundRules,
    );

    return `# ðŸš€ Project Team Align Report
      > Created at: ${new Date().toLocaleDateString()} ${new Date().toLocaleTimeString()}

      ## 1. ðŸ§  Team Style Analysis
      Team consensus indicates the following working style:
      ${teamStyleString}

      ## 2. ðŸ›  Tech Stack Selection
      | Tech Name | Version | Status |
      | :--- | :--- | :--- |
      ${techStackString}

      ## 3. ðŸ“œ Ground Rules
      ### Coding Convention
      ${groundRulesString}

      ## 4. ðŸ“ Sticky Notes
      (No notes added)

      ---
      *Generated by ${createMarkdownDto.workspaceName}*`;
  }

  createTeamStyleString(teamStyles: TeamStyle[]) {
    return teamStyles
      .map(
        (style) =>
          `- **${style.name}:** ${style.score} âš–ï¸ (Score: ${style.score}/100)`,
      )
      .join('\n');
  }

  createTechStackString(techStacks: TechStack[]) {
    return techStacks
      .map((stack) => `| ${stack.name} | ${stack.version} | ${stack.status} |`)
      .join('\n');
  }

  createGroundRulesString(groundRules: GroundRules[]) {
    return groundRules
      .map((rule) => `- [x] **${rule.name}:** ${rule.description}`)
      .join('\n');
  }
}
