import { Test, TestingModule } from '@nestjs/testing';

import { MarkdownService } from '../markdown.service';
import { YjsDocReaderService } from '../../collaboration/yjs-doc-reader.service';

describe('MarkdownService', () => {
  let service: MarkdownService;
  let yjsDocReaderMock: { getWidgets: jest.Mock };
  const workspaceId = 'w1';

  beforeEach(async () => {
    yjsDocReaderMock = {
      getWidgets: jest.fn(),
    };

    const module: TestingModule = await Test.createTestingModule({
      providers: [
        MarkdownService,
        {
          provide: YjsDocReaderService,
          useValue: yjsDocReaderMock,
        },
      ],
    }).compile();

    service = module.get<MarkdownService>(MarkdownService);
    jest.useFakeTimers().setSystemTime(new Date('2024-01-01T12:00:00Z'));
  });

  afterEach(() => {
    jest.useRealTimers();
  });

  it('ëª¨ë“  ìœ„ì ¯ì´ ì—†ìœ¼ë©´ í—¤ë”, í‘¸í„°, ì•ˆë‚´ ë¬¸êµ¬ë¥¼ ë°˜í™˜í•œë‹¤.', () => {
    yjsDocReaderMock.getWidgets.mockReturnValue([]);

    const markdown = service.generateMarkdown(workspaceId);

    expect(markdown).toContain(
      'ì•„ì§ ì ì€ ë‚´ìš©ì´ ì—†ëŠ” ê²ƒ ê°™ìŠµë‹ˆë‹¤! ìœ„ì ¯ì— ë‚´ìš©ì„ ì¶”ê°€í•´ë³´ì„¸ìš”! ğŸš€',
    );
    expect(markdown).toContain('*Generated by TeamConfig*');
  });
});
